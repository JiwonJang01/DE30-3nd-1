# í¸ì§€ê°€ ë„ì°©í–ˆìŠµë‹ˆë‹¤

![image](https://github.com/pladata-encore/DE30-3nd-1/assets/161932948/f44cf47d-0dd7-40e0-a888-ad5ee832f690)


## íˆ´

### ë°±ì—”ë“œ

<img src="https://img.shields.io/badge/Java-ED8B00?style=for-the-badge&logo=openjdk&logoColor=whitee" />  

<img src="https://img.shields.io/badge/Spring-6DB33F?style=for-the-badge&logo=spring&logoColor=white" />  

<img src="https://img.shields.io/badge/Spring_Security-6DB33F?style=for-the-badge&logo=Spring-Security&logoColor=white" />  

### í”„ë¡ íŠ¸
<img src="https://img.shields.io/badge/HTML-239120?style=for-the-badge&logo=html5&logoColor=white" /> 

<img src="https://img.shields.io/badge/CSS-239120?&style=for-the-badge&logo=css3&logoColor=white" /> 
 
<img src="https://img.shields.io/badge/JavaScript-F7DF1E?style=for-the-badge&logo=JavaScript&logoColor=white" />  

### DB
<img src="https://img.shields.io/badge/MariaDB-003545?style=for-the-badge&logo=mariadb&logoColor=white" />  


### ì‘ì—…íˆ´
<img src="https://img.shields.io/badge/IntelliJ_IDEA-000000.svg?style=for-the-badge&logo=intellij-idea&logoColor=white" />  

## ëª©ì°¨

[í”„ë¡œì íŠ¸ ê°œìš”](https://github.com/pladata-encore/DE30-3nd-1/tree/main?tab=readme-ov-file#%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EA%B0%9C%EC%9A%94)

[ë°±ì—”ë“œ](https://github.com/pladata-encore/DE30-3nd-1/tree/main?tab=readme-ov-file#%EB%B0%B1%EC%97%94%EB%93%9C-1)

[í”„ë¡ íŠ¸](https://github.com/pladata-encore/DE30-3nd-1/tree/main?tab=readme-ov-file#%ED%94%84%EB%A1%A0%ED%8A%B8-1)

[ë°°í¬](https://github.com/pladata-encore/DE30-3nd-1/tree/main?tab=readme-ov-file#%EB%B0%B0%ED%8F%AC)

##  Members 
- ìœ¤ì†Œì˜ 
- ì •ì œìœ¤ 
- ê³½íƒœí˜¸ 
- ì¥ì§€ì›
- ìµœì€ì„œ

# í”„ë¡œì íŠ¸ ê°œìš”


## ğŸ£ í”„ë¡œì íŠ¸ ì†Œê°œ
ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì‚¬ìš©ìê°€ ë°›ê³  ì‹¶ì€ í¸ì§€ ìœ í˜•ì„ ì„ íƒí•˜ë©´ ë‹¤ë¥¸ ì‚¬ìš©ìê°€ í¸ì§€ë¥¼ ì‘ì„±í•˜ì—¬ ë³´ë‚¼ ìˆ˜ ìˆëŠ” ì›¹ì„œë¹„ìŠ¤ë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
ë°›ê³  ì‹¶ì€ í¸ì§€ ìœ í˜•ê³¼ êµ¬ì²´ì ì¸ ë‚´ìš©ì„ ì…ë ¥í•˜ë©´ ì‚¬ì´íŠ¸ ì‚¬ìš©ì ëˆ„êµ¬ë‚˜ í¸ì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤



### ì„œë¹„ìŠ¤ ì‹œì—°
![](https://velog.velcdn.com/images/devysy55/post/025a9adb-86cb-4501-95e4-6bc474fecd7c/image.gif)



## ğŸ’» í”„ë¡œì íŠ¸ êµ¬ì¡°

ì¶”ê°€ì˜ˆì •

## â­ í”„ë¡œì íŠ¸ ëª©í‘œ
- ìŠ¤í”„ë§ë¶€íŠ¸ í™œìš© ëŠ¥ë ¥ í–¥ìƒ
- api ê°œë°œ, DB ì„¤ê³„ ë“± ë°±ì—”ë“œ ëŠ¥ë ¥ í–¥ìƒ
- í”„ë¡ íŠ¸ ì›¹í˜ì´ì§€ ì œì‘


## ğŸ“– í”„ë¡œì íŠ¸ ê¸°íš
### í”¼ê·¸ë§ˆë¥¼ í™œìš©í•œ ê¸°íšì„œ ì‘ì„±(í™”ë©´ì„¤ê³„ì„œ, ì™€ì´ì–´í”„ë ˆì„)
![](https://velog.velcdn.com/images/devysy55/post/4d0fe97b-f954-46bc-a859-e11c63cd3a51/image.png)

- [figma ë°”ë¡œê°€ê¸° ë§í¬](https://www.figma.com/design/DH4LJTcuM0VVW1bMyVEYxG/3%EC%B0%A8-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8?node-id=0-1&t=YUL0zFJ7tUl3oPJV-1)
- descriptionê¹Œì§€ ì‘ì„±í•œ í™”ë©´ì„¤ê³„ì„œ ì‘ì„±í•˜ì—¬ í˜‘ì—…
<img src='https://velog.velcdn.com/images/devysy55/post/07f4d997-c9c8-4486-bf9c-534d3adabf98/image.png' width=800px></img>


<br>
<br>

### êµ¬ê¸€ ê³µìœ ë¬¸ì„œë¥¼ í™œìš©í•œ DB, API í˜‘ì—…ìš© ë¬¸ì„œ ì‘ì„±

![](https://velog.velcdn.com/images/devysy55/post/99bcae97-0212-4f51-9f53-6df85adb6ff6/image.png)

- ê¸°íš ë‹¨ê³„ ì´í›„ DB, api ê°œë°œì„ ìœ„í•´   DB ì„¤ê³„ì„œ, API ëª…ì„¸ì„œ



# ë°±ì—”ë“œ

<br>

## ë°±ì—”ë“œ ì—¬ëŸ¬ë¶„ ì—¬ê¸°ë‹¤ ë„£ì–´ì¤˜ìš”


## ë¡œê·¸ì¸ ë° íšŒì›ê°€ì…
####ê³½íƒœí˜¸
- ë¡œê·¸ì¸ ë° íšŒì›ê°€ì… í™”ë©´
- í¸ì§€ ìƒì„¸ ë‚´ìš©


### ë¡œê·¸ì¸/íšŒì›ê°€ì…: spring security ì‚¬ìš©

### spring security
- Spring ê¸°ë°˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë³´ì•ˆì„ ë‹´ë‹¹í•˜ëŠ” í”„ë ˆì„ ì›Œí¬
- ì¸ì¦ê³¼ ê¶Œí•œì— ëŒ€í•´ Filter íë¦„ì— ë”°ë¼ ì²˜ë¦¬í•˜ê³  ìˆìœ¼ë©° ë³´ì•ˆê³¼ ê´€ë ¨í•´ì„œ ë§ì€ ì˜µì…˜ì„ ì œê³µí•´ì£¼ê³  ìˆê¸° ë•Œë¬¸ì— ê°œë°œìê°€ ì¼ì¼ì´ ë³´ì•ˆ ë¡œì§ì„ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ëœë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.

### spring security ì¸ì¦ ì²˜ë¦¬ ê³¼ì •
![](https://velog.velcdn.com/images/taehokk/post/0006457b-24df-412c-875e-49980de8bb1d/image.png)
1 ì‚¬ìš©ìê°€ í¼ì— ì•„ì´ë””, íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥í•˜ë©´ HTTPServletRequestì— ì•„ì´ë””, ë¹„ë°€ë²ˆí˜¸ ì •ë³´ê°€ ì „ë‹¬. ì´ë•Œ AuthenticationFilterê°€ ë„˜ì–´ì˜¨ ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ì˜ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ì‹¤ì‹œí•œë‹¤.

2 ìœ íš¨ì„± ê²€ì‚¬ í›„ ì‹¤ì œ êµ¬í˜„ì²´ì¸ UsernamePasswordAuthenticationTokenì„ ë§Œë“¤ì–´ ë„˜ê²¨ì¤€ë‹¤.

3 ì¸ì¦ìš© ê°ì²´ì¸ UsernamePasswordAuthenticationTokenì„ AuthenticationManagerì—ê²Œ ì „ë‹¬í•œë‹¤.

4 UsernamePasswordAuthenticationTokenì„ AuthenticationProviderì—ê²Œ ì „ë‹¬í•œë‹¤.

5 ì‚¬ìš©ì ì•„ì´ë””ë¥¼ UserDetailsServiceë¡œ ë³´ëƒ…ë‹ˆë‹¤. UserDetailServiceëŠ” ì‚¬ìš©ì ì•„ì´ë””ë¡œ ì°¾ì€ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ UserDetails ê°ì²´ë¡œ ë§Œë“¤ì–´ AuthenticationProviderì—ê²Œ ì „ë‹¬í•œë‹¤.

6 DBì— ìˆëŠ” ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¨ë‹¤.

7 ì…ë ¥ ì •ë³´ì™€ UserDetailsì˜ ì •ë³´ë¥¼ ë¹„êµí•´ ì‹¤ì œ ì¸ì¦ ì²˜ë¦¬ë¥¼ ì§„í–‰í•œë‹¤.

8~ 10ê¹Œì§€ ì¸ì¦ì´ ì™„ë£Œë˜ë©´ SecurityContextHolderì— Authenticationì„ ì €ì¥í•œë‹¤.
ì¸ì¦ ì„±ê³µ ì—¬ë¶€ì— ë”°ë¼ ì„±ê³µ ì‹œ AuthenticationSuccessHandler, ì‹¤íŒ¨ ì‹œ AuthenticationFailureHandler í•¸ë“¤ëŸ¬ë¥¼ ì‹¤í–‰í•œë‹¤.

[ì¶œì²˜](https://velog.io/@dh1010a/Spring-Spring-Security%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%EA%B5%AC%ED%98%84-%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8-3.X-%EB%B2%84%EC%A0%84-1)




### êµ¬ì„±
Authentication
- ì¸ì¦ì€ ì‚¬ìš©ìì˜ ì‹ ì›ì„ í™•ì¸í•˜ëŠ” ê³¼ì •ìœ¼ë¡œ, ì‚¬ìš©ìê°€ ì œê³µí•œ ìê²© ì¦ëª…(ì˜ˆ: ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸)ì„ ê²€ì¦í•˜ì—¬ ì‚¬ìš©ìë¥¼ ì‹ë³„í•œë‹¤. 
- Spring SecurityëŠ” ë‹¤ì–‘í•œ ì¸ì¦ ë°©ì‹ì„ ì§€ì›í•˜ë©°, ì‚¬ìš©ì ì •ë³´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤, LDAP ì„œë²„, ë©”ëª¨ë¦¬ ë“± ë‹¤ì–‘í•œ ì†ŒìŠ¤ì—ì„œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

Authorization
- ì¸ê°€ëŠ” ì¸ì¦ëœ ì‚¬ìš©ìì—ê²Œ íŠ¹ì • ë¦¬ì†ŒìŠ¤ ë˜ëŠ” ê¸°ëŠ¥ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ” ê³¼ì •ì´ë‹¤. 
- Spring SecurityëŠ” ì„¸ë¶„í™”ëœ ê¶Œí•œ ê´€ë¦¬ë¥¼ ì§€ì›í•˜ì—¬, ì—­í•  ê¸°ë°˜ì˜ ì ‘ê·¼ ì œì–´ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤. 
- ì´ë¥¼ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì ‘ê·¼ ì œí•œì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.




### ìˆœí™˜ ì°¸ì¡° ë¬¸ì œ ë°œìƒ

#### ìˆœí™˜ ì°¸ì¡°
- ìˆœí™˜ ì°¸ì¡°ëŠ” ë‘ ê°œ ì´ìƒì˜ ë¹ˆì´ ì„œë¡œë¥¼ ì˜ì¡´í•˜ëŠ” ìƒí™©ì„ ë§í•œë‹¤.
- ì˜ˆë¥¼ ë“¤ì–´, í´ë˜ìŠ¤ Aê°€ í´ë˜ìŠ¤ Bë¥¼ ì˜ì¡´í•˜ê³ , í´ë˜ìŠ¤ Bê°€ ë‹¤ì‹œ í´ë˜ìŠ¤ Aë¥¼ ì˜ì¡´í•  ë•Œ ìˆœí™˜ ì°¸ì¡°ê°€ ë°œìƒí•œë‹¤. ì´ëŸ° ê²½ìš°, Spring ì»¨í…Œì´ë„ˆëŠ” ì–´ëŠ ë¹ˆì„ ë¨¼ì € ìƒì„±í•´ì•¼ í• ì§€ ê²°ì •í•˜ì§€ ëª»í•´ ìˆœí™˜ ì°¸ì¡° ì˜ˆì™¸ë¥¼ ë°œìƒí•œë‹¤.


#### í•´ê²°
- ê¸°ë³¸ì ìœ¼ë¡œ Spring Boot 2.6 ì´ìƒì—ì„œëŠ” ìˆœí™˜ ì°¸ì¡°ê°€ í—ˆìš©ë˜ì§€ ì•ŠëŠ”ê²Œ defaultê°’ì´ë‹¤.
- ì´ë¥¼ spring.main.allow-circular-references=true ì„¤ì •í•˜ì—¬ ìˆœí™˜ ì°¸ì¡°ë¥¼ í—ˆìš©í•œë‹¤.
- í•˜ì§€ë§Œ ì´ëŠ” ì¼ì‹œì ì¸ í•´ê²°ë²•ìœ¼ë¡œ ë‚˜ì¤‘ì— ê·¼ë³¸ì ìœ¼ë¡œ í•´ê²°í•˜ê¸° ìœ„í•´ ì„¤ê³„ êµ¬ì„±ì„ ë³€ê²½í•´ì•¼í•œë‹¤.


---

## í¸ì§€ ìƒì„¸ ë‚´ìš©

#### controller ì½”ë“œ
```
@GetMapping("/letterDetails/{id}")
public String getLetterContentById(@PathVariable("id") Long id, Model model) {
    Letter letter = letterService.findLetterById(id);
    if (letter == null) {
        return "error"; 
    model.addAttribute("letter", letter);
    return "letterContent";
}
```

- letterService.findLetterById(id): idì— í•´ë‹¹í•˜ëŠ” í¸ì§€ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒí•œë‹¤

- model.addAttribute("letter", letter): letter ê°ì²´ë¥¼ ëª¨ë¸ì— ì¶”ê°€í•˜ì—¬ ë·°ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤

- /letterDetails/{id}ì˜ idëŠ” í¸ì§€ì˜ ì‹ë³„ì

- í¸ì§€ë¥¼ ì°¾ì§€ ëª»í•œ ê²½ìš° error í˜ì´ì§€ë¡œ ì´ë™


#### service ì½”ë“œ
```
    public String getLetterContentById(Long id) {
        Letter letter = letterRepository.findById(id).orElse(null);
        if (letter == null) {
            return null; 
        }
        return letter.getContent();
    }
```


- letterRepository.findById(id): idì— í•´ë‹¹í•˜ëŠ” í¸ì§€ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒí•œë‹¤.
- .orElse(null): Optional ê°ì²´ì— ê°’ì´ ì¡´ì¬í•˜ë©´ ê·¸ ê°’ì„ ë°˜í™˜í•˜ê³ , ê°’ì´ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ nullì„ ë°˜í™˜í•œë‹¤.


#### repository ì½”ë“œ
```
public interface LetterRepository extends JpaRepository<Letter, Long> {
    List<Letter> findByRecipient(String recipient);

    @Query("SELECT l FROM Letter l JOIN l.letterType lt WHERE lt.user.idx_user = :userId")
    List<Letter> findLettersByUserId(@Param("userId") Long userId);
}
```

- extends JpaRepository: JpaRepositoryë¥¼ í™•ì¥í•˜ì—¬ ê¸°ë³¸ì ì¸ CRUD ê¸°ëŠ¥ì„ ìƒì†ë°›ìœ¼ë©°, ì¶”ê°€ë¡œ ì‚¬ìš©ì ì •ì˜ ì¿¼ë¦¬ë¥¼ ì •ì˜í•  ìˆ˜ ìˆë‹¤.

- JPQL(Java Persistence Query Language)ì„ ì‚¬ìš©í•˜ì—¬ ì»¤ìŠ¤í…€ ì¿¼ë¦¬ë¥¼ ì •ì˜í•œë‹¤.
- @Query: Letter ì—”í‹°í‹°ì™€ ì—°ê´€ëœ letterType ì—”í‹°í‹°ë¥¼ ì¡°ì¸í•˜ê³ , userIdê°€ ì¼ì¹˜í•˜ëŠ” Letter ëª©ë¡ì„ ê²€ìƒ‰gksek.
- @Param ì–´ë…¸í…Œì´ì…˜: userIdë¥¼ ì¿¼ë¦¬ ë§¤ê°œë³€ìˆ˜ë¡œ ì‚¬ìš©í•œë‹¤.


#### JPQL
íŠ¹ì§•
- jpaì—ì„œ sqlì„ ì¶”ìƒí™”í•œ JPQLì´ë¼ëŠ” ê°ì²´ ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ë¥¼ ì œê³µí•œë‹¤.
- sqlì²˜ëŸ¼í…Œì´ë¸”ì„ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬ í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬í•œë‹¤.
- sql ë¬¸ë²•ê³¼ ë§¤ìš° ìœ ì‚¬í•˜ë‹¤.

ë¬¸ì œì 
- JPQLì€ ê¸°ë³¸ ë¬¸ìì—´ë¡œ ì‘ì„±ë˜ê¸° ë•Œë¬¸ì— ì»´íŒŒì¼ ì‹œ ì—ëŸ¬ë¥¼ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.
- ë•Œë¬¸ì— ë¬¸ì œê°€ ìˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³  ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ì—¬ ë°°í¬ ì‹œ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
- ë™ì ìœ¼ë¡œ ì¿¼ë¦¬ ì–¸ì–´ë¥¼ ì‘ì„±í•˜ëŠ” ë° íš¨ìœ¨ì ì´ì§€ ëª»í•˜ë‹¤.

<br>
<br>

## í¸ì§€ì‘ì„±

ìµœì€ì„œ
- í¸ì§€ ì‘ì„± í˜ì´ì§€


### Letter ì—”í„°í‹° ì„¤ì •

[ì½”ë“œ]

```
package com.example.letterapp.model;

import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.ManyToOne;
import lombok.Getter;
import lombok.Setter;

@Entity
@Getter
@Setter
public class Letter {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String title;
    private String content;
    private String sender;
    private String recipient;

    @ManyToOne
    private LetterType letterType;

    }
    
 ```
<Letter-ë°›ëŠ” í¸ì§€>		

ì „ì†¡ë˜ëŠ” (ë‹µì¥)í¸ì§€ë“¤ì— í•´ë‹¹ë©ë‹ˆë‹¤. ì‘ì„± ì¦‰ì‹œ ì €ì¥ë˜ê³ , ëˆ„ì ë©ë‹ˆë‹¤. 
![](https://velog.velcdn.com/images/eschoi2402/post/ea43e24c-7122-4ae0-bc99-d0093ad623b5/image.png)

Entity: ì´ í´ë˜ìŠ¤ê°€ JPA ì—”í‹°í‹°ì„ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì— ë§¤í•‘ë©ë‹ˆë‹¤.

@Getterì™€ @Setter: Lombok ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ìë™ìœ¼ë¡œ getterì™€ setter ë©”ì„œë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

@Id: í•„ë“œê°€ ì—”í‹°í‹°ì˜ ê¸°ë³¸ í‚¤(primary key)ì„ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
@GeneratedValue(strategy = GenerationType.IDENTITY): ê¸°ë³¸ í‚¤ ìƒì„±ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ìœ„ì„í•©ë‹ˆë‹¤. 

private Long id; : í¸ì§€ì˜ ê³ ìœ  ì‹ë³„ì(Primary Key)
private String title; : í¸ì§€ì˜ ì œëª©
private String content; : í¸ì§€ì˜ ë‚´ìš©
private String sender; : ë°œì‹ ì
private String recipient; : ìˆ˜ì‹ ì

LetterType ì—”í„°í‹°ì™€ ë‹¤ëŒ€ì¼ ê´€ê³„ë¥¼ ì„¤ì •í–ˆìŠµë‹ˆë‹¤. ì¦‰, ì—¬ëŸ¬ í¸ì§€ê°€ í•˜ë‚˜ì˜ LetterTypeì„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![](https://velog.velcdn.com/images/eschoi2402/post/59adb76f-3fb8-407c-9e41-8b8488eec4fd/image.png)





### LetterController

1. í¸ì§€ ì •ë³´ ì¡°íšŒ ë©”ì„œë“œ

```
@Operation(summary = "Show letter info by ID")
@GetMapping("/letterinfo")
public String showLetterInfo(@RequestParam Long letterIdx, Model model) {
    Letter letter = letterService.findLetterById(letterIdx);
    model.addAttribute("letter", letter);
    return "letterinfo";
}
```

@Operation: ì´ ë©”ì„œë“œì˜ Swagger ë¬¸ì„œí™” ì •ë³´ë¥¼ ì œê³µí•˜ë©° ìš”ì•½ ì •ë³´ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
@GetMapping("/letterinfo"): /letterinfo ê²½ë¡œë¡œ GET ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œ ì´ ë©”ì„œë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
@RequestParam Long letterIdx: ìš”ì²­ ë§¤ê°œë³€ìˆ˜ë¡œ letterIdxë¥¼ ë°›ìŠµë‹ˆë‹¤.
Model: ë·°ë¡œ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.
í¸ì§€ ì •ë³´ë¥¼ ì¡°íšŒí•˜ì—¬ letterinfo ë·°ì— ì „ë‹¬í•©ë‹ˆë‹¤.

2. ìƒˆ í¸ì§€ ë³´ë‚´ê¸° ë©”ì„œë“œ

```
@Operation(summary = "Send a new letter")
@PostMapping("/send")
public String sendLetter(
        @RequestParam(name = "title") String title,
        @RequestParam(name = "content") String content,
        @RequestParam(name = "sender") String sender,
        @RequestParam(name = "recipient") String recipient,
        @RequestParam(name = "letterTypeId") Long letterTypeId,
        Model model) {
    Letter letter = new Letter();
    letter.setTitle(title);
    letter.setContent(content);
    letter.setSender(sender);
    letter.setRecipient(recipient);
    letter.setLetterType(letterTypeService.findLetterTypeById(letterTypeId));
    letterService.saveLetter(letter);
    model.addAttribute("status", "í¸ì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤");
    return "redirect:/";
}
```
@PostMapping("/send"): /send ê²½ë¡œë¡œ POST ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œ ì´ ë©”ì„œë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
í¸ì§€ ì •ë³´ë¥¼ ë°›ì•„ ìƒˆë¡œìš´ í¸ì§€ë¥¼ ìƒì„±í•˜ê³  ì €ì¥í•œ í›„, í™ˆ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•©ë‹ˆë‹¤.



3. ì‚¬ìš©ì í¸ì§€ ëª©ë¡ ì¡°íšŒ ë©”ì„œë“œ

```
@Operation(summary = "Show letters page for the authenticated user")
@GetMapping("/letters")
public String showLettersPage(@AuthenticationPrincipal UserDetails userDetails, Model model) {
    if (userDetails != null) {
        User user = userService.findByNickname(userDetails.getUsername());
        if (user != null) {
            List<Letter> letters = letterService.findLettersByUserId(user.getIdx_user());
            model.addAttribute("letters", letters);
        }
    }
    return "letters";
}
```


@AuthenticationPrincipal UserDetails userDetails: í˜„ì¬ ì¸ì¦ëœ ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
ì‚¬ìš©ìì˜ í¸ì§€ ëª©ë¡ì„ ì¡°íšŒí•˜ì—¬ letters ë·°ì— ì „ë‹¬í•©ë‹ˆë‹¤.


4. í¸ì§€ ë‚´ìš© ì¡°íšŒ ë©”ì„œë“œ

```
@Operation(summary = "Show letter content by ID")
@GetMapping("/letters/{id}")
public String showLetterPage(@PathVariable Long id, Model model) {
    Letter letter = letterService.findLetterById(id);
    if (letter == null) {
        return "error"; // í¸ì§€ë¥¼ ì°¾ì§€ ëª»í•œ ê²½ìš° ì—ëŸ¬ í˜ì´ì§€ë¡œ ì´ë™
    }
    model.addAttribute("letter", letter);
    return "letterContent";
}
```

@GetMapping("/letters/{id}"): /letters/{id} ê²½ë¡œë¡œ GET ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œ ì´ ë©”ì„œë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. {id}ëŠ” ê²½ë¡œ ë³€ìˆ˜ì…ë‹ˆë‹¤.
íŠ¹ì • IDì˜ í¸ì§€ë¥¼ ì¡°íšŒí•˜ì—¬ letterContent ë·°ì— ì „ë‹¬í•©ë‹ˆë‹¤.


5. ì¸ë±ìŠ¤ í˜ì´ì§€ í‘œì‹œ ë©”ì„œë“œ

```
@Operation(summary = "Show index page")
@GetMapping("/index")
public String showIndexPage(Model model, @AuthenticationPrincipal UserDetails userDetails) {
    if (userDetails != null) {
        User user = userService.findByNickname(userDetails.getUsername());
        if (user != null) {
            List<Letter> letters = letterService.findLettersByRecipient(user.getNickname());
            model.addAttribute("letters", letters);
        }
    }
    long totalLetters = letterService.countLetters(); // ì „ì²´ í¸ì§€ ìˆ˜ ê³„ì‚°
    model.addAttribute("totalLetters", totalLetters); // ëª¨ë¸ì— ì¶”ê°€
    return "index"; // ì¸ë±ìŠ¤ í˜ì´ì§€ë¡œ ì´ë™
}
```

@GetMapping("/index"): /index ê²½ë¡œë¡œ GET ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œ ì´ ë©”ì„œë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
ì¸ì¦ëœ ì‚¬ìš©ìì˜ í¸ì§€ ëª©ë¡ê³¼ ì „ì²´ í¸ì§€ ìˆ˜ë¥¼ ì¡°íšŒí•˜ì—¬ index ë·°ì— ì „ë‹¬í•©ë‹ˆë‹¤.


### LetterService


1. í¸ì§€ ì €ì¥ ë©”ì„œë“œ
```
public void saveLetter(Letter letter) {
    letterRepository.save(letter);
}
```
í¸ì§€ ê°ì²´ë¥¼ ë°›ì•„ letterRepositoryë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•©ë‹ˆë‹¤.

2. ëª¨ë“  í¸ì§€ ì¡°íšŒ ë©”ì„œë“œ
```
public List<Letter> findAllLetters() {
    return letterRepository.findAll();
}
```
ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ëª¨ë“  í¸ì§€ë¥¼ ì¡°íšŒí•˜ì—¬ ë¦¬ìŠ¤íŠ¸ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.

3. IDë¡œ í¸ì§€ ì¡°íšŒ ë©”ì„œë“œ
```
public Letter findLetterById(Long id) {
    return letterRepository.findById(id).orElse(null);
}
```
ì£¼ì–´ì§„ IDë¡œ í¸ì§€ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤. í•´ë‹¹ IDì˜ í¸ì§€ê°€ ì—†ìœ¼ë©´ nullì„ ë°˜í™˜í•©ë‹ˆë‹¤.

4. ìˆ˜ì‹ ì ì´ë¦„ìœ¼ë¡œ í¸ì§€ ì¡°íšŒ ë©”ì„œë“œ
```
public List<Letter> findLettersByRecipient(String recipient) {
    return letterRepository.findByRecipient(recipient);
}
```
ì£¼ì–´ì§„ ìˆ˜ì‹ ì ì´ë¦„ìœ¼ë¡œ í¸ì§€ë¥¼ ì¡°íšŒí•˜ì—¬ ë¦¬ìŠ¤íŠ¸ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.

5. ì‚¬ìš©ì IDë¡œ í¸ì§€ ì¡°íšŒ ë©”ì„œë“œ
```
public List<Letter> findLettersByUserId(Long userId) {
    return letterRepository.findLettersByUserId(userId);
}
```
ì£¼ì–´ì§„ ì‚¬ìš©ì IDë¡œ í¸ì§€ë¥¼ ì¡°íšŒí•˜ì—¬ ë¦¬ìŠ¤íŠ¸ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.

6. ëª¨ë“  í¸ì§€ ìœ í˜• ì¡°íšŒ ë©”ì„œë“œ
```
public List<LetterType> findAllLetterTypes() {
    return letterTypeRepository.findAll();
}
```
ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ëª¨ë“  í¸ì§€ ìœ í˜•ì„ ì¡°íšŒí•˜ì—¬ ë¦¬ìŠ¤íŠ¸ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.

7. í¸ì§€ ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ ë©”ì„œë“œ
```
public List<Letter> getLettersWithComments() {
    return letterRepository.findAll();
}
```
ëª¨ë“  í¸ì§€ ëª©ë¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤.

8. í¸ì§€ ë‚´ìš© ì¡°íšŒ ë©”ì„œë“œ
```
public String getLetterContentById(Long id) {
    Letter letter = letterRepository.findById(id).orElse(null);
    if (letter == null) {
        return null; // í•´ë‹¹ IDì˜ í¸ì§€ê°€ ì—†ì„ ê²½ìš°
    }
    return letter.getContent(); // í¸ì§€ì˜ ë‚´ìš© ë°˜í™˜
}
```
ì£¼ì–´ì§„ IDì˜ í¸ì§€ ë‚´ìš©ì„ ì¡°íšŒí•˜ì—¬ ë°˜í™˜í•©ë‹ˆë‹¤. í•´ë‹¹ IDì˜ í¸ì§€ê°€ ì—†ìœ¼ë©´ nullì„ ë°˜í™˜í•©ë‹ˆë‹¤.

9. 
ì „ì²´ í¸ì§€ ìˆ˜ ê³„ì‚° ë©”ì„œë“œ
```
public long countLetters() {
    return letterRepository.count();
}
```
ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ëœ ì „ì²´ í¸ì§€ì˜ ìˆ˜ë¥¼ ê³„ì‚°í•˜ì—¬ ë°˜í™˜í•©ë‹ˆë‹¤. (ì´ ë°œì†¡ëœ í¸ì§€ì˜ ê°œìˆ˜ í™ˆ í™”ë©´ì—ì„œ íŒŒì•…í•˜ê¸° ìœ„í•¨)


### LetterRepository

1. ìˆ˜ì‹ ì ì´ë¦„ìœ¼ë¡œ í¸ì§€ ì¡°íšŒ

```
List<Letter> findByRecipient(String recipient);
```
ìˆ˜ì‹ ì ì´ë¦„(recipient)ìœ¼ë¡œ í¸ì§€ ëª©ë¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤.

2. ì‚¬ìš©ì IDë¡œ í¸ì§€ ì¡°íšŒ
```
@Query("SELECT l FROM Letter l JOIN l.letterType lt WHERE lt.user.idx_user = :userId")
List<Letter> findLettersByUserId(@Param("userId") Long userId);
```
@Query ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì ì •ì˜ JPQL(Java Persistence Query Language) ì¿¼ë¦¬ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
Letter ì—”í„°í‹°ì™€ LetterType ì—”í„°í‹°ë¥¼ ì¡°ì¸í•˜ì—¬ íŠ¹ì • ì‚¬ìš©ì ID(userId)ì™€ ê´€ë ¨ëœ í¸ì§€ ëª©ë¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤.
@Param("userId")ëŠ” ì¿¼ë¦¬ì—ì„œ ì‚¬ìš©í•˜ëŠ” íŒŒë¼ë¯¸í„°ë¥¼ ë°”ì¸ë”©í•©ë‹ˆë‹¤.


3. ì „ì²´ í¸ì§€ ìˆ˜ ê³„ì‚°
```
long count();
```
ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ëœ ì „ì²´ í¸ì§€ì˜ ìˆ˜ë¥¼ ê³„ì‚°í•˜ì—¬ ë°˜í™˜í•©ë‹ˆë‹¤. 


<br>
<br>

## ìš”ì²­ í¸ì§€

#### ì¥ì§€ì›
- ìš”ì²­ í¸ì§€ ì„¤ì • í˜ì´ì§€

### í™ˆí™”ë©´ì— ì „ì²´ í¸ì§€ ê±´ìˆ˜ ì¹´ìš´íŠ¸ - get
Letter í…Œì´ë¸”ì„ ì „ì²´ì˜ í–‰ ìˆ˜ë¥¼ ê°€ì ¸ì˜¤ëŠ” apiì…ë‹ˆë‹¤.
ë¡œê·¸ì¸ ì „í›„ í™”ë©´ ìƒë‹¨ì—ì„œ 'ì§€ê¸ˆê¹Œì§€ Nê±´ì˜ í¸ì§€ë¥¼ ì „ë‹¬í–ˆì–´ìš”' ë¶€ë¶„ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```JAVA
@GetMapping("/count")
    public Map<String, Long> getLetterCount() {
        long count = letterCountService.countLetters();
        Map<String, Long> response = new HashMap<>();
        response.put("count", count);
        return response;
    }
```
![](https://velog.velcdn.com/images/jiw0707/post/acca43a3-e681-4cee-a349-e27bdb482ec6/image.png)

## ë°›ê³  ì‹¶ì€ í¸ì§€ ì„¤ì •(LetterType)

### LetterType í…Œì´ë¸”
LetterType í…Œì´ë¸”ì„ ì‚¬ìš©ìê°€ ìš”ì²­í•œ í¸ì§€ì˜ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” í…Œì´ë¸”ì…ë‹ˆë‹¤. idx_userì»¬ëŸ¼ì„ í†µí•´ì„œ userí…Œì´ë¸”ê³¼ ë§¤í•‘í•˜ì—¬ ì‚¬ìš©ì ë³„ë¡œ ë‹¤ë¥¸ ë°ì´í„°ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆê²Œ í•˜ì˜€ìŠµë‹ˆë‹¤.
í•´ë‹¹ í…Œì´ë¸”ì€ ì •ë³´ë¥¼ ì €ì¥í•  ë•Œë§ˆë‹¤ ê°±ì‹ ë˜ëŠ” í…Œì´ë¸”ì…ë‹ˆë‹¤. ë”°ë¼ì„œ ìƒˆë¡œìš´ ìš”ì²­ í¸ì§€ê°€ ì €ì¥ë˜ë©´ ì´ì „ì˜ ìš”ì²­ í¸ì§€ëŠ” ì‚¬ë¼ì§‘ë‹ˆë‹¤.
![](https://velog.velcdn.com/images/jiw0707/post/a92337a4-3221-48d6-9c38-f37efeb326b0/image.png)

### ìš”ì²­ í¸ì§€ ë¦¬ìŠ¤íŠ¸
'ë°›ê³  ì‹¶ì€ í¸ì§€ ì„ íƒí•˜ê¸°'ì—ì„œ ì €ì¥í•œ í¸ì§€ë“¤ì˜ ë¦¬ìŠ¤íŠ¸ë¥¼ ë§Œë“¤ê¸°ìœ„í•´ ì „ì²´ LetterType í…Œì´ë¸”ì˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤. í•´ë‹¹ ë¦¬ìŠ¤íŠ¸ëŠ” ë¡œê·¸ì¸ ì „í›„ í™”ë©´ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```JAVA
@GetMapping("/want")
    public List<Map<String, Object>> getAllLetterTypesWithUserDetails() {
        return letterTypeService.getAllLetterTypesWithUserDetails();
    }
```
![](https://velog.velcdn.com/images/jiw0707/post/65b57732-fe5c-4f21-a9ee-8a3f997f5334/image.png)

### ì‚¬ìš©ìì˜ ì´ë©”ì¼ ì „ì†¡ ì—¬ë¶€, ëœë¤ì—¬ë¶€ í™•ì¸
userí…Œì´ë¸”ì—ì„œ ì´ë©”ì¼ ì „ì†¡ ì—¬ë¶€ì™€ ì´ë©”ì¼ ì£¼ì†Œ, ëœë¤ í¸ì§€ ìˆ˜ì‹ ì—¬ë¶€ì— ëŒ€í•œ ì •ë³´ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
```JAVA
@GetMapping("/user/{idx_user}/select")
    public User getUserSelect(@PathVariable("idx_user") Long idx_user) {
        return userService.getUserById(idx_user);
    }
```
![](https://velog.velcdn.com/images/jiw0707/post/871eae78-87f8-4cbf-9875-c0f8275b9545/image.png)



### ì‚¬ìš©ìì˜ í¸ì§€ ìœ í˜• ì„ íƒ ì •ë³´
ì‚¬ìš©ìê°€ ì„ íƒí•œ í¸ì§€ ìœ í˜•ê³¼ ì €ì¥ëœ ì½”ë©˜íŠ¸ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤. ì´ ì •ë³´ëŠ” ì‚¬ìš©ì ë³„ë¡œ ë‹¤ë¥¸ ì •ë³´ë¥¼ ê°€ì§„ í™”ë©´ì„ ë³´ì—¬ì£¼ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— userí…Œì´ë¸”ì˜ ì •ë³´ë„ í•„ìš”í•©ë‹ˆë‹¤.
```JAVA
@GetMapping("/user/{idx_user}/lettertype")
    public List<LetterType> getLetterTypesForUser
            (@PathVariable("idx_user") Long idx_user) {
        return letterTypeService.getLetterTypesForUser(idx_user);
    }
```
![](https://velog.velcdn.com/images/jiw0707/post/77da2c5d-be8e-4d7a-bf04-696e1e23b776/image.png)



### ë°›ê³  ì‹¶ì€ í¸ì§€ ì„ íƒí•˜ê¸° ì •ë³´ ë³€ê²½
ì…ë ¥ í™”ë©´ì—ì„œ ë‚´ìš©ì„ ë³€ê²½í•œ í›„ ì €ì¥í•˜ê¸° ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ìœ ì €ì˜ ì´ë©”ì¼ ìˆ˜ì‹  ì—¬ë¶€, ì´ë©”ì¼ ì£¼ì†Œ, ëœë¤ í¸ì§€ ìˆ˜ì‹  ì—¬ë¶€ì™€ í¸ì§€ ìœ í˜• ì„ í˜¸ë„ë¥¼ ì—…ë°ì´íŠ¸ í•©ë‹ˆë‹¤.
```JAVA
@PatchMapping("/change/{letterTypeId}")
    public ResponseEntity<LetterType> updateLetterType(@PathVariable("letterTypeId") Long letterTypeId, @RequestBody LetterTypeDto letterTypeDto) {
        try {
            // ì£¼ì–´ì§„ letterTypeIdë¡œ LetterType ì—”í‹°í‹°ë¥¼ ê°€ì ¸ì˜´
            Optional<LetterType> optionalLetterType = letterTypeService.getLetterTypeById(letterTypeId);

            // letterTypeIdì— í•´ë‹¹í•˜ëŠ” LetterTypeì´ ì—†ëŠ” ê²½ìš°
            if (!optionalLetterType.isPresent()) {
                return ResponseEntity.notFound().build(); // 404 Not Found
            }

            LetterType letterType = optionalLetterType.get();

            // User ì—”í‹°í‹°ë„ ì—…ë°ì´íŠ¸
            User user = userService.getUserById(letterTypeDto.getUserIdx());
            if (user == null) {
                return ResponseEntity.badRequest().body(null); // Userê°€ ì—†ì„ ê²½ìš° ì˜ˆì™¸ ì²˜ë¦¬
            }
            user.setEmail_sub(letterTypeDto.isEmailSub());
            user.setEmail(letterTypeDto.getEmail());
            user.setRandom_sub(letterTypeDto.isRandomSub());

            // User ì—”í‹°í‹° ì €ì¥
            userService.saveUser(user);

            // LetterTypeDtoì—ì„œ í•„ìš”í•œ í•„ë“œë¡œ LetterType ì—”í‹°í‹°ë¥¼ ì—…ë°ì´íŠ¸
            if (letterTypeDto.getCategory() != null) {
                letterType.setCategory(letterTypeDto.getCategory());
            }
            if (letterTypeDto.getComment() != null) {
                letterType.setComment(letterTypeDto.getComment());
            }
            if (letterTypeDto.getDateRecieve() != null) {
                letterType.setDate_recieve(letterTypeDto.getDateRecieve());
            }

            // LetterType ì—”í‹°í‹° ì €ì¥
            LetterType updatedLetterType = letterTypeService.saveLetterType(letterType);

            // ì—…ë°ì´íŠ¸ëœ ì„±ê³µì‹œ ë°˜í™˜
            return ResponseEntity.ok(updatedLetterType); // 200 OK
        } catch (Exception e) { // ì—…ë°ì´íŠ¸ëœ ì‹¤íŒ¨ì‹œ ë°˜í™˜
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build(); // 500 Internal Server Error
        }
    }
```
![](https://velog.velcdn.com/images/jiw0707/post/43f87f3e-6d20-4ba5-ad9a-c868f9a05e0e/image.png)

</br>
</br>

## Swagger ì—°ë™
#### ìœ¤ì†Œì˜
- SpringDoc OpenAPI Starter WebMVC UI ì‚¬ìš©í•˜ì—¬ Swagger ì—°ë™

```
implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.5.0'
````

<img src='https://velog.velcdn.com/images/devysy55/post/e907c885-55f2-4fc8-9720-1c2f9b7bc3c3/image.png' width=600px></img>

## í”„ë¡ íŠ¸ ì‘ì—… ê³¼ì •ì—ì„œ apiì¶”ê°€ ì‘ì—…
#### ìœ¤ì†Œì˜
### @GetMapping("/api/user/idx")
- ë°›ê³  ì‹¶ì€ í¸ì§€ ì„ íƒí•˜ê¸° í™”ë©´ ì œì‘ ì¤‘ resquest ê°’ì— ë¡œê·¸ì¸ í•œ íšŒì›ì˜ idx ì •ë³´ í•„ìš”í•œ ì´ìŠˆ ë°œìƒ
- UserController

```
 public UserController(UserService userService) {
        this.userService = userService;
    }

    @Operation(summary = "ë¡œê·¸ì¸ ìœ ì € Idx ì •ë³´ ê°€ì ¸ì˜´")
    @GetMapping("/api/user/idx")
    public Long getLoggedInUserId(@AuthenticationPrincipal UserDetails userDetails) {
        if (userDetails != null) {
            User user = userService.findByNickname(userDetails.getUsername());
            if (user != null) {
                return user.getIdx_user(); // ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ Idx ë°˜í™˜
            }
        }
        return null; // ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í•˜ì§€ ì•Šì•˜ê±°ë‚˜ ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ëŠ” ê²½ìš°
    }
```
  
## @GetMapping("/letters")
- ë°›ì€ í¸ì§€í•¨ ì‘ì—… ì¤‘ íšŒì›ë³„ ë°›ì€ í¸ì§€ ì¡°íšŒ api ì¶”ê°€
- LetterController
```
  @Operation(summary = "ë¡œê·¸ì¸ íšŒì›ì˜ ë°›ì€ í¸ì§€ ì¡°íšŒ")
    @GetMapping("/letters")
    public String showLettersPage(@AuthenticationPrincipal UserDetails userDetails, Model model) {
        if (userDetails != null) {
            User user = userService.findByNickname(userDetails.getUsername());
            if (user != null) {
                List<Letter> letters = letterService.findLettersByUserId(user.getIdx_user());
                model.addAttribute("letters", letters);
            }
        }
        return "letters";
    }
```

- LetterService
```
public List<Letter> findLettersByUserId(Long userId) {
        return letterRepository.findLettersByUserId(userId);
    }
```

- LetterRepository
```
 @Query("SELECT l FROM Letter l JOIN l.letterType lt WHERE lt.user.idx_user = :userId")
    List<Letter> findLettersByUserId(@Param("userId") Long userId);
```

<br>
<br>
  
# í”„ë¡ íŠ¸
- HTML, CSS, JavaScript, ê·¸ë¦¬ê³  Thymeleaf í…œí”Œë¦¿ ì—”ì§„ì„ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„

## ë¡œê·¸ì¸ ë° íšŒì›ê°€ì… í™”ë©´ style ì„¤ì •í•˜ê¸°
### ì •ì œìœ¤

```
<style>
        table {
            width: 280px;
            height: 300px;
            margin: auto;
            font-size: 15px;
            border-collapse: collapse;
        }
        input[type="text"].nickname {
            width: 250px;
            height: 32px;
            font-size: 15px;
            border: 0;
            border-radius: 15px;
            outline: none;
            padding-left: 10px;
            background-color: rgb(233,233,233);
        }
</style>
```

1. ë¡œê·¸ì¸ ë° íšŒì›ê°€ì… í™”ë©´ì˜ ì „ì²´ í…Œì´ë¸” í¬ê¸° ì§€ì • ë° ì˜µì…˜ ì„¤ì •í•˜ê¸°
2. ë¡œê·¸ì¸ ë° íšŒì›ê°€ì… í™”ë©´ì— í‘œì‹œë  í•­ëª©ë³„ë¡œ í´ë˜ìŠ¤ ì„¤ì •í•˜ì—¬ ì ìš©í•  ë””ìì¸ ë° ì˜µì…˜ ì„¤ì •í•˜ê¸°

<br/>

```
<body>
<form th:action="@{/login}" method="post">
    <table>
        <tr>
            <td class="center-text"><h2>ë¡œê·¸ì¸</h2></td> <!-- ê°€ìš´ë° ì •ë ¬ í´ë˜ìŠ¤ ì¶”ê°€ -->
        </tr>
        <tr>
            <td>ë‹‰ë„¤ì„</td>
        </tr>
        <tr>
            <td><input type="text" class="nickname" placeholder=" ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" th:name="username" required></td>
        </tr>
    </table>
</body>
```

1. styleì— ì„¤ì •í•œ ì˜µì…˜ ë° í´ë˜ìŠ¤ ì§€ì •í•˜ì—¬ ë¡œê·¸ì¸ íšŒì›ê°€ì… í™”ë©´ì— êµ¬í˜„í•  ë‚´ìš© bodyì— ì½”ë“œ ì‘ì„±í•˜ê¸°
2. Thymeleaf ì†ì„± ì ìš©í•  ë¶€ë¶„ í‘œê¸°í•˜ê¸° ('th:', '@{/}')
<br/>

### CSS

```
.login {
    width: 280px;
    height: 300px;
    margin: auto;
    font-size: 15px;
    border-collapse: collapse;
    margin: auto;
}
input[type="text"].nickname, input[type="password"].password {
    width: 250px;
    height: 32px;
    font-size: 15px;
    border: 0;
    border-radius: 15px;
    outline: none;
    padding-left: 10px;
    background-color: rgb(233,233,233);
}
input.nickname::placeholder, input.password::placeholder {
    font-size: 12px;
}
```

1. CSSí´ë”ë¥¼ ìƒì„±í•˜ì—¬ ë°˜ë³µì ìœ¼ë¡œ ì ìš©ë˜ëŠ” ë””ìì¸ íŒ¨í„´ì„ CSS íŒŒì¼ì— í´ë˜ìŠ¤ë³„ë¡œ ì €ì¥í•˜ê¸°
2. ì¶”ê°€ì ìœ¼ë¡œ ì ìš©í•  ë””ìì¸ ë° ì˜µì…˜ì„ í´ë˜ìŠ¤ í˜•íƒœë¡œ CSSíŒŒì¼ì— ì‘ì„±í•˜ê¸°

<br/>

```
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" type="text/css" th:href="@{css/style.css}">
</head>
```

1. headì— CSSíŒŒì¼ ê²½ë¡œ ì„¤ì •í•˜ê¸°
2. Thymeleaf ì†ì„± ì ìš©í•˜ì—¬ CSSíŒŒì¼ ì—°ê²°í•˜ê¸°
<br/>

```
<body>
<form th:action="@{/login}" method="post">
    <table class = "login">
        <tr>
            <td class="center-text"><h2>ë¡œê·¸ì¸</h2></td>
        </tr>
        <tr>
            <td>ë‹‰ë„¤ì„</td>
        </tr>
        <tr>
            <td><input type="text" class="nickname" placeholder=" ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" th:name="username" required></td>
        </tr>
        <tr>
            <td>ë¹„ë°€ë²ˆí˜¸</td>
        </tr>
        <tr>
            <td><input type="password" class="password" placeholder=" ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”" th:name="password" required></td>
        </tr>
        <tr>
            <td><button type="submit" class="btn">ë¡œê·¸ì¸í•˜ê¸°</button></td>
        </tr>
        <tr>
            <td class="join"><a th:href="@{/register}">íšŒì›ê°€ì…</a></td>
        </tr>
    </table>
</form>
</body>
```

1. CSSì— ì‘ì„±í•œ í…Œì´ë¸” ì ìš©í•˜ì—¬ ë¡œê·¸ì¸ íšŒì›ê°€ì… í™”ë©´ì— êµ¬í˜„í•  ë‚´ìš© bodyì— ì½”ë“œ ì‘ì„±í•˜ê¸°
<br/>




## í™ˆ, í¸ì§€í•¨, ë°›ê³ ì‹¶ì€ í¸ì§€ ì„ íƒ, í¸ì§€ì“°ê¸° í™”ë©´ ì œì‘ ë° apiì—°ë™
### ìœ¤ì†Œì˜
### ì£¼ìš” ì‘ì—… ì‚¬í•­
- ë¶€íŠ¸ìŠ¤íŠ¸ë©, ì»¤ìŠ¤í…€cssí™œìš©í•˜ì—¬ ë””ìì¸ ì ìš©
- JavaScript ì‚¬ìš©í•˜ì—¬ ì„œë²„ë¡œë¶€í„° í¸ì§€ í¬ë§ ë“± ë°ì´í„°ë¥¼ ë™ì ìœ¼ë¡œ ê°€ì ¸ì˜´
- DOMContentLoaded ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì‚¬ìš©í•˜ì—¬ í˜ì´ì§€ê°€ ë¡œë“œë˜ë©´ ì„¸ì…˜ ì €ì¥ì†Œì—ì„œ íŠ¹ì • ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜´
- Ajaxë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì„œë²„ì™€ í†µì‹ 
  
###  ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œ ì¼ë¶€
```
  document.addEventListener('DOMContentLoaded', function () {
        fetch('/api/lettertype/want')
            .then(response => response.json())
            .then(data => {
                // ë°ì´í„°ë¥¼ ë‚ ì§œë³„ë¡œ ì •ë ¬í•©ë‹ˆë‹¤.
                data.sort((a, b) => {
                    return new Date(b.date_receive) - new Date(a.date_receive);
                });

                const letterWishList = document.getElementById('letter-wish-list');
                data.forEach(item => {
                    if (item.comment !== null && item.comment !== "null") {
                        const listItem = document.createElement('li');
                        listItem.className = 'list-group-item';
                        const categoryColor = getCategoryColor(item.category[0]);
                        listItem.innerHTML = `
                            <span style="font-size: 13px; color: ${categoryColor};">${getCategoryText(item.category[0])}</span>
                            <span style="font-size: 13px;">  ${item.nickname}</span><br>

                            ${item.comment}<br>
                            <span style="font-size: 13px;">${item.date_receive ? new Date(new Date(item.date_receive).getTime() + (9 * 60 * 60 * 1000)).toLocaleString('ko-KR', {
                                timeZone: 'Asia/Seoul',
                                year: 'numeric',
                                month: '2-digit',
                                day: '2-digit',
                                hour12: false,
                                hour: '2-digit',
                                minute: '2-digit'
                            }) : 'ë‚ ì§œ ì •ë³´ ì—†ìŒ'}</span>
                        `;
                        listItem.addEventListener('click', function() {
                            if (!isAuthenticated()) {
                                window.location.href = '/login';
                            } else {
                                // ì„ íƒëœ í•­ëª©ì˜ ì •ë³´ë¥¼ sessionStorageì— ì €ì¥í•©ë‹ˆë‹¤.
                                sessionStorage.setItem('selectedLetter', JSON.stringify(item));
                                window.location.href = '/write';
                            }
                        });
                        letterWishList.appendChild(listItem);
                    }
                });
            });
    });

    function isAuthenticated() {
        return document.getElementById('isAuthenticated').value === 'true';
    }

    function getCategoryText(category) {
        switch(category) {
            case 1: return 'ì¬ë°ŒëŠ” ì–˜ê¸°í•´ ì£¼ì„¸ìš”ğŸ˜„';
            case 2: return 'ìœ„ë¡œ ë°›ê³  ì‹¶ì–´ìš”ğŸ˜¥';
            case 3: return 'ê³ ë¯¼ ìˆì–´ìš” ì¡°ì–¸í•´ ì£¼ì„¸ìš”ğŸ˜¯';
            case 4: return 'ì•„ë¬´ë§ ëŒ€ì”ì¹˜ğŸŸ';
            default: return 'ê¸°íƒ€';
        }
    }

    function getCategoryColor(category) {
        switch(category) {
            case 1: return 'blue';
            case 2: return 'green';
            case 3: return 'orange';
            case 4: return 'red';
            default: return 'black';
        }
    }
 ```
  
  
## ê°œì„  ì˜ˆì •
- ì½”ë“œ êµ¬ì¡° ê°œì„ 
  - JavaScript ì½”ë“œ ëª¨ë“ˆí™”
  - í•¨ìˆ˜ ë¦¬íŒ©í† ë§
- ìŠ¤íƒ€ì¼ ê°œì„ 
  - ë°˜ì‘í˜• ë””ìì¸ ë“± ìŠ¤íƒ€ì¼ ê°œì„ 
- ì—ëŸ¬ ì²˜ë¦¬ ì¶”ê°€
  - ì„œë²„ì™€ì˜ í†µì‹ ì´ ì‹¤íŒ¨í•  ê²½ìš° ì‚¬ìš©ìì—ê²Œ ì ì ˆí•œ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ë„ë¡ ì—ëŸ¬ ì²˜ë¦¬
  
<br> 
  
# ë°°í¬
- https://cloudtype.io/ í™œìš© ì„œë²„ ë°°í¬(ë¬´ë£Œ ë²„ì „ ì‚¬ìš©)
 ![](https://velog.velcdn.com/images/devysy55/post/bbf7ba7a-d606-4600-bd82-dd028869dc40/image.png)

